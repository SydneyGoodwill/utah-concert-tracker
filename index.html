<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>What's Happening in Northern Utah Tonight?</title>
    <link rel="stylesheet" type="text/css" href="css/style.css">
  </head>
  <body>
    <h1>Select a Venue to see what's playing tonight!</h1>

    <!-- This is 7-2 ... GOAL 1: Standard Dropdown Menu-->
     <div>
      <label for="siteSelectorDropdown">Choose A Venue:</label>
      <!-- FIXED: Removed the extra closing </select> tag -->
      <select id="siteSelectorDropdown" onchange="LoadIntoIframe(this)"></select>
     </div>

     <br>

     <!-- GOAL 2: Search Input Field -->
      <div>
        <label for="searchInput">Search for a Venue:</label>
         <input type="text" id="searchInput" placeholder="Search options..." list="optionList" onchange="LoadIntoIframe(this)">
      </div>

      <!-- The Master List of Options (hidden from view, feeds both the select and input above)-->
      <datalist id="optionList" style="display: none;">
        <!-- START OF OPTIONS (Use full https:// URLs here for the links/iframes to work) -->
        <optgroup label="Layton">
          <!-- URL Example: value="https://www.davisarts.org" -->
          <option value="www.davisarts.org" data-second-link="www.davisarts.org">Davis Arts Council (multiple venues)</option>
        </optgroup>
        <!-- ... Include all your options here exactly once with correct URLs ... -->
        <optgroup label="West Valley City">
           <option value="www.utahfirstamp.com" data-second-link="www.utahfirstamp.com">USANA / Utah First ... Amphitheater</option>
        </optgroup>
        <option value="KRCL Events" data-second-link="krcl.org"></option>
        <!-- END OF OPTIONS -->
      </datalist>

    <!-- The iframe where the selected site will load -->
    <div class="iframe-container">
      <iframe id="contentFrame" src="" title="Selected Website Content">
        Your browser does not support iframes.
      </iframe>
    </div>

    <!-- This new div will hold the second clickable link -->
    <div id="secondLinkContainer" style="margin-top: 15px;"></div>

    <script>
      // 1. ROBUSTLY DUPLICATE OPTIONS INTO THE DROPDOWN (via the functioning JS cloning):
      document.addEventListener('DOMContentLoaded', (event) => {
          const dataListOptions = document.getElementById('optionList').querySelectorAll('option, optgroup');
          const selectDropdown = document.getElementById('siteSelectorDropdown');

          // Since the select is empty in HTML source, we don't need a heavy clear loop.
          // Append a default option first
          const defaultOption = document.createElement('option');
          defaultOption.value = "";
          defaultOption.textContent = "--Select a Venue--";
          selectDropdown.appendChild(defaultOption);

          // Clone the rest of the nodes exactly (including all data attributes)
          dataListOptions.forEach(node => {
              const clonedNode = node.cloneNode(true); 
              selectDropdown.appendChild(clonedNode);
          });
      });

      // 2. The JavaScript function called by the onchange event
      function LoadIntoIframe(element) { 
          const iframeElement = document.getElementById("contentFrame");
          const secondLinkContainer = document.getElementById("secondLinkContainer");
          const selectedUrl = element.value;

          // 1. Handle the main IFRAME URL
          // This will fail until you fix your URLs to start with https://
          if (selectedUrl) {
              iframeElement.src = selectedUrl;
          } else {
              iframeElement.src = "";
          }

          // 2. Handle the SECOND LINK URL retrieval
          let secondLinkUrl = '';
          let venueName = '';

          if (element.tagName === 'SELECT') {
              const selectedOption = element.options[element.selectedIndex];
              secondLinkUrl = selectedOption.getAttribute('data-second-link');
              venueName = selectedOption.text.trim();
              
          } else if (element.tagName === 'INPUT') {
              const datalistOptions = document.getElementById('optionList').options;
              for (let i = 0; i < datalistOptions.length; i++) {
                  if (datalistOptions[i].value === element.value) {
                      secondLinkUrl = datalistOptions[i].getAttribute('data-second-link');
                      venueName = datalistOptions[i].text.trim();
                      break;
                  }
              }
          }

          // 3. Create the clickable *button* link in the container div
          // This will also fail until you fix your URLs to start with https://
          if (secondLinkUrl) {
              secondLinkContainer.innerHTML = 
                `<a href="${secondLinkUrl}" target="_blank" class="action-button">
                  Visit External Website for ${venueName}
                 </a>`;
          } else {
              secondLinkContainer.innerHTML = '';
          }
      }
    </script>
  </body>
</html>

